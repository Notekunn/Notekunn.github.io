{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/2020/08/30/huong-dan-setup-kma-support-phan-3/","result":{"data":{"markdownRemark":{"id":"dd4c9b4d-86c1-52c2-a5a0-adb04da0782a","html":"<h2 id=\"lời-mở-đầu\" style=\"position:relative;\"><a href=\"#l%E1%BB%9Di-m%E1%BB%9F-%C4%91%E1%BA%A7u\" aria-label=\"lời mở đầu permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LỜI MỞ ĐẦU</h2>\n<p><a href=\"/posts/2020/08/30/huong-dan-setup-kma-support-phan-1\">Xem phần trước</a>.</p>\n<p>Phần này mình sẽ hướng dẫn deploy service <code class=\"language-text\">bot</code>.</p>\n<p><a href=\"https://github.com/kma-academy/kma-schedule-bot\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Source code</a></p>\n<h2 id=\"cài-đặt\" style=\"position:relative;\"><a href=\"#c%C3%A0i-%C4%91%E1%BA%B7t\" aria-label=\"cài đặt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài đặt</h2>\n<ul>\n<li>\n<p>Tải source code về</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/kma-academy/kma-schedule-bot\n<span class=\"token builtin class-name\">cd</span> kma-schedule-bot</code></pre></div>\n</li>\n<li>\n<p>Install package</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"cấu-hình\" style=\"position:relative;\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh\" aria-label=\"cấu hình permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cấu hình</h2>\n<p>Cấu hình file <code class=\"language-text\">.env</code>.</p>\n<p>Trong đó:</p>\n<ul>\n<li><code class=\"language-text\">HOST_URL</code>,<code class=\"language-text\">PORT</code>: Địa chỉ, port trang webhook bot(VD: <code class=\"language-text\">http://localhost:3000</code>,<code class=\"language-text\">3000</code>)</li>\n<li><code class=\"language-text\">TIME_ZONE</code>, <code class=\"language-text\">TIME_FORMAT</code>: Time zone, time format server(VD: <code class=\"language-text\">Asia/Ho_Chi_Minh</code>, <code class=\"language-text\">DD/MM/YYYY</code>).</li>\n<li><code class=\"language-text\">PAGE_TOKEN</code>, <code class=\"language-text\">PAGE_ID</code>: token, id page.</li>\n<li><code class=\"language-text\">APP_ID</code>, <code class=\"language-text\">APP_SECRET</code>: id và secret key</li>\n<li><code class=\"language-text\">VERIFY_TOKEN</code>, <code class=\"language-text\">ADMIN_TOKEN</code>: chuỗi verify webhook và token admin full quyền.</li>\n<li><code class=\"language-text\">SCHEDULE_SERVER</code>: Server api đã deploy.</li>\n<li><code class=\"language-text\">MONGODB_STRING</code>: Mongodb uri (<code class=\"language-text\">mongodb+srv://&lt;user&gt;:&lt;pass&gt;@&lt;host&gt;/&lt;api_database&gt;?retryWrites=true&amp;w=majority</code>).</li>\n<li><code class=\"language-text\">NODE_ENV</code>: Môi trường làm việc (<code class=\"language-text\">development</code> | <code class=\"language-text\">production</code>).</li>\n</ul>\n<h2 id=\"cấu-hình-app\" style=\"position:relative;\"><a href=\"#c%E1%BA%A5u-h%C3%ACnh-app\" aria-label=\"cấu hình app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cấu hình app</h2>\n<ul>\n<li>Mở developer dashboard facebook</li>\n<li>Chọn app đã tạo thêm sản phẩm messenger:\n<img src=\"https://i.imgur.com/O3v0edY.png\" alt=\"Ảnh minh họa\"></li>\n<li>Ở phần mã truy cập chọn thêm trang đã tạo:\n<img src=\"https://i.imgur.com/FMYHq6V.png\" alt=\"Ảnh minh họa\"></li>\n<li>Lấy token page:\n<img src=\"https://i.imgur.com/ACaYRl9.png\" alt=\"Ảnh minh họa\"></li>\n<li>Cấu hình url webhook <code class=\"language-text\">HOST_URL/webhook</code>(yêu cầu https) và <code class=\"language-text\">VERIFY_TOKEN</code>:\n<img src=\"https://i.imgur.com/CbOQ6YO.png\" alt=\"Ảnh minh họa\"></li>\n<li>Đăng ký event:\n<img src=\"https://i.imgur.com/WhWbJYT.png\" alt=\"Ảnh minh họa\"></li>\n<li>Chuyển sang chế độ hoạt động</li>\n<li>Lấy token admin <a href=\"https://sharescript.net/2019/02/10/huong-dan-lay-token-facebook-full-quyen-02-2019/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tại đây</a></li>\n</ul>\n<h2 id=\"xét-duyệt-ứng-dụng\" style=\"position:relative;\"><a href=\"#x%C3%A9t-duy%E1%BB%87t-%E1%BB%A9ng-d%E1%BB%A5ng\" aria-label=\"xét duyệt ứng dụng permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Xét duyệt ứng dụng</h2>\n<p>Đang cập nhật…</p>\n<h2 id=\"deploy\" style=\"position:relative;\"><a href=\"#deploy\" aria-label=\"deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> start</code></pre></div>\n<h2 id=\"develop\" style=\"position:relative;\"><a href=\"#develop\" aria-label=\"develop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Develop</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> run develop</code></pre></div>\n<h2 id=\"hướng-dẫn-trỏ-host-khác-về-localhost\" style=\"position:relative;\"><a href=\"#h%C6%B0%E1%BB%9Bng-d%E1%BA%ABn-tr%E1%BB%8F-host-kh%C3%A1c-v%E1%BB%81-localhost\" aria-label=\"hướng dẫn trỏ host khác về localhost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hướng dẫn trỏ host khác về localhost</h2>\n<p>Trong quá trình develop facebook cần 1 callback url, dùng localhost thì không được.\nTa sẽ sử dụng inlets deploy lên heroku như 1 cầu nối </p>\n<p>Xem hướng dẫn chi tiết <a href=\"https://blog.ngxson.com/31-truy-cap-localhost-tu-heroku/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tại đây</a></p>\n<p>Chúc các bạn thành công.</p>","fields":{"slug":"/posts/2020/08/30/huong-dan-setup-kma-support-phan-3/","tagSlugs":["/tag/javascript/","/tag/programming/","/tag/tutorial/","/tag/kma/"]},"frontmatter":{"date":"2020-08-30T13:00:00.000Z","description":"Cài đặt và cấu hình kma schedule bot","tags":["Javascript","Programming","Tutorial","KMA"],"title":"Hướng dẫn setup KMA Support (Phần 3)","socialImage":null}}},"pageContext":{"slug":"/posts/2020/08/30/huong-dan-setup-kma-support-phan-3/"}},"staticQueryHashes":["251939775","401334301","825871152"]}